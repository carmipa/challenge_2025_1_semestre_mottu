-- Gerado por Oracle SQL Developer Data Modeler 23.1.0.087.0806
--   em:        2025-05-08 23:22:53 BRT (Modificado para remover auditoria)
--   site:      Oracle Database 21c
--   tipo:      Oracle Database 21c
--   MODIFICADO PARA INCLUIR GENERATED BY DEFAULT AS IDENTITY
--   MODIFICADO PARA REMOVER TABELAS E TRIGGERS DE AUDITORIA

-- predefined type, no DDL - MDSYS.SDO_GEOMETRY

-- predefined type, no DDL - XMLTYPE

CREATE TABLE t_cp (
    tb_patio_id_patio     NUMBER NOT NULL,
    tb_contato_id_contato NUMBER NOT NULL
);
ALTER TABLE t_cp ADD CONSTRAINT t_cp_pk PRIMARY KEY ( tb_patio_id_patio,
                                                      tb_contato_id_contato );

CREATE TABLE t_ep (
    tb_endereco_id_endereco NUMBER NOT NULL,
    tb_patio_id_patio       NUMBER NOT NULL
);
ALTER TABLE t_ep ADD CONSTRAINT t_ep_pk PRIMARY KEY ( tb_endereco_id_endereco,
                                                      tb_patio_id_patio );

CREATE TABLE tb_box (
    id_box       NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    nome         VARCHAR2(50) NOT NULL,
    status       CHAR(1) NOT NULL,
    data_entrada DATE NOT NULL,
    data_saida   DATE NOT NULL,
    observacao   VARCHAR2(100)
);
ALTER TABLE tb_box ADD CONSTRAINT tb_box_pk PRIMARY KEY ( id_box );

CREATE TABLE tb_cliente (
    id_cliente              NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    data_cadastro           DATE NOT NULL,
    sexo                    CHAR(2) NOT NULL,
    nome                    VARCHAR2(100) NOT NULL,
    sobrenome               VARCHAR2(100) NOT NULL,
    data_nascimento         DATE NOT NULL,
    cpf                     CHAR(11) NOT NULL,
    profissao               VARCHAR2(50) NOT NULL,
    estado_civil            VARCHAR2(50) NOT NULL,
    tb_endereco_id_endereco NUMBER NOT NULL,
    tb_contato_id_contato   NUMBER NOT NULL
);
ALTER TABLE tb_cliente
    ADD CONSTRAINT tb_cliente_pk PRIMARY KEY ( id_cliente,
                                               tb_endereco_id_endereco,
                                               tb_contato_id_contato );

CREATE TABLE tb_contato (
    id_contato NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    email      VARCHAR2(100) NOT NULL,
    ddd        NUMBER(4) NOT NULL,
    ddi        NUMBER(4) NOT NULL,
    telefone1  VARCHAR2(20) NOT NULL,
    telefone2  VARCHAR2(20),
    telefone3  VARCHAR2(20),
    celular    VARCHAR2(20) NOT NULL,
    outro      VARCHAR2(100),
    observacao VARCHAR2(200)
);
ALTER TABLE tb_contato ADD CONSTRAINT tb_contato_pk PRIMARY KEY ( id_contato );

CREATE TABLE tb_cv (
    tb_cliente_id_cliente              NUMBER NOT NULL,
    tb_cliente_tb_endereco_id_endereco NUMBER NOT NULL,
    tb_cliente_tb_contato_id_contato   NUMBER NOT NULL,
    tb_veiculo_id_veiculo              NUMBER NOT NULL
);
ALTER TABLE tb_cv
    ADD CONSTRAINT tb_cv_pk PRIMARY KEY ( tb_cliente_id_cliente,
                                          tb_cliente_tb_endereco_id_endereco,
                                          tb_cliente_tb_contato_id_contato,
                                          tb_veiculo_id_veiculo );

CREATE TABLE tb_endereco (
    id_endereco NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    cep         CHAR(9) NOT NULL,
    numero      NUMBER(7) NOT NULL,
    logradouro  VARCHAR2(50) NOT NULL,
    bairro      VARCHAR2(50) NOT NULL,
    cidade      VARCHAR2(50) NOT NULL,
    estado      CHAR(2) NOT NULL,
    pais        VARCHAR2(50) NOT NULL,
    complemento VARCHAR2(60),
    observacao  VARCHAR2(200)
);
ALTER TABLE tb_endereco ADD CONSTRAINT tb_endereco_pk PRIMARY KEY ( id_endereco );

CREATE TABLE tb_patio (
    id_patio     NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    nome_patio   VARCHAR2(50) NOT NULL,
    data_entrada DATE NOT NULL,
    data_saida   DATE NOT NULL,
    observacao   VARCHAR2(100)
);
ALTER TABLE tb_patio ADD CONSTRAINT tb_patio_pk PRIMARY KEY ( id_patio );

CREATE TABLE tb_rastreamento (
    id_rastreamento NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    ips             mdsys.sdo_geometry NOT NULL,
    gprs            mdsys.sdo_geometry NOT NULL
);
ALTER TABLE tb_rastreamento ADD CONSTRAINT tb_rastreamento_pk PRIMARY KEY ( id_rastreamento );

CREATE TABLE tb_vb (
    tb_veiculo_id_veiculo NUMBER NOT NULL,
    tb_box_id_box         NUMBER NOT NULL
);
ALTER TABLE tb_vb ADD CONSTRAINT tb_vb_pk PRIMARY KEY ( tb_veiculo_id_veiculo,
                                                        tb_box_id_box );

CREATE TABLE tb_veiculo (
    id_veiculo  NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    placa       VARCHAR2(10) NOT NULL,
    renavam     CHAR(11) NOT NULL,
    chassi      CHAR(17) NOT NULL,
    fabricante  VARCHAR2(50) NOT NULL,
    modelo      VARCHAR2(60) NOT NULL,
    motor       VARCHAR2(30),
    ano         NUMBER NOT NULL,
    combustivel VARCHAR2(20) NOT NULL
);
ALTER TABLE tb_veiculo ADD CONSTRAINT tb_veiculo_pk PRIMARY KEY ( id_veiculo );

CREATE TABLE tb_vp (
    tb_veiculo_id_veiculo NUMBER NOT NULL,
    tb_patio_id_patio     NUMBER NOT NULL
);
ALTER TABLE tb_vp ADD CONSTRAINT tb_vp_pk PRIMARY KEY ( tb_veiculo_id_veiculo,
                                                        tb_patio_id_patio );

CREATE TABLE tb_vr (
    tb_veiculo_id_veiculo           NUMBER NOT NULL,
    tb_rastreamento_id_rastreamento NUMBER NOT NULL
);
ALTER TABLE tb_vr ADD CONSTRAINT tb_vr_pk PRIMARY KEY ( tb_veiculo_id_veiculo,
                                                        tb_rastreamento_id_rastreamento );

CREATE TABLE tb_vz (
    tb_veiculo_id_veiculo NUMBER NOT NULL,
    tb_zona_id_zona       NUMBER NOT NULL
);
ALTER TABLE tb_vz ADD CONSTRAINT tb_vz_pk PRIMARY KEY ( tb_veiculo_id_veiculo,
                                                        tb_zona_id_zona );

CREATE TABLE tb_zb (
    tb_zona_id_zona NUMBER NOT NULL,
    tb_box_id_box   NUMBER NOT NULL
);
ALTER TABLE tb_zb ADD CONSTRAINT tb_zb_pk PRIMARY KEY ( tb_zona_id_zona,
                                                        tb_box_id_box );

CREATE TABLE tb_zona (
    id_zona      NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    nome         VARCHAR2(50) NOT NULL,
    data_entrada DATE NOT NULL,
    data_saida   DATE NOT NULL,
    observacao   VARCHAR2(100)
);
ALTER TABLE tb_zona ADD CONSTRAINT tb_zona_pk PRIMARY KEY ( id_zona );

CREATE TABLE tb_zp (
    tb_patio_id_patio NUMBER NOT NULL,
    tb_zona_id_zona   NUMBER NOT NULL
);
ALTER TABLE tb_zp ADD CONSTRAINT tb_zp_pk PRIMARY KEY ( tb_patio_id_patio,
                                                        tb_zona_id_zona );

-- Foreign Key Constraints
ALTER TABLE t_cp
    ADD CONSTRAINT t_cp_tb_contato_fk FOREIGN KEY ( tb_contato_id_contato )
        REFERENCES tb_contato ( id_contato );
ALTER TABLE t_cp
    ADD CONSTRAINT t_cp_tb_patio_fk FOREIGN KEY ( tb_patio_id_patio )
        REFERENCES tb_patio ( id_patio );
ALTER TABLE t_ep
    ADD CONSTRAINT t_ep_tb_endereco_fk FOREIGN KEY ( tb_endereco_id_endereco )
        REFERENCES tb_endereco ( id_endereco );
ALTER TABLE t_ep
    ADD CONSTRAINT t_ep_tb_patio_fk FOREIGN KEY ( tb_patio_id_patio )
        REFERENCES tb_patio ( id_patio );
ALTER TABLE tb_cliente
    ADD CONSTRAINT tb_cliente_tb_contato_fk FOREIGN KEY ( tb_contato_id_contato )
        REFERENCES tb_contato ( id_contato );
ALTER TABLE tb_cliente
    ADD CONSTRAINT tb_cliente_tb_endereco_fk FOREIGN KEY ( tb_endereco_id_endereco )
        REFERENCES tb_endereco ( id_endereco );
ALTER TABLE tb_cv
    ADD CONSTRAINT tb_cv_tb_cliente_fk FOREIGN KEY ( tb_cliente_id_cliente,
                                                     tb_cliente_tb_endereco_id_endereco,
                                                     tb_cliente_tb_contato_id_contato )
        REFERENCES tb_cliente ( id_cliente,
                                tb_endereco_id_endereco,
                                tb_contato_id_contato );
ALTER TABLE tb_cv
    ADD CONSTRAINT tb_cv_tb_veiculo_fk FOREIGN KEY ( tb_veiculo_id_veiculo )
        REFERENCES tb_veiculo ( id_veiculo );
ALTER TABLE tb_vb
    ADD CONSTRAINT tb_vb_tb_box_fk FOREIGN KEY ( tb_box_id_box )
        REFERENCES tb_box ( id_box );
ALTER TABLE tb_vb
    ADD CONSTRAINT tb_vb_tb_veiculo_fk FOREIGN KEY ( tb_veiculo_id_veiculo )
        REFERENCES tb_veiculo ( id_veiculo );
ALTER TABLE tb_vp
    ADD CONSTRAINT tb_vp_tb_patio_fk FOREIGN KEY ( tb_patio_id_patio )
        REFERENCES tb_patio ( id_patio );
ALTER TABLE tb_vp
    ADD CONSTRAINT tb_vp_tb_veiculo_fk FOREIGN KEY ( tb_veiculo_id_veiculo )
        REFERENCES tb_veiculo ( id_veiculo );
ALTER TABLE tb_vr
    ADD CONSTRAINT tb_vr_tb_rastreamento_fk FOREIGN KEY ( tb_rastreamento_id_rastreamento )
        REFERENCES tb_rastreamento ( id_rastreamento );
ALTER TABLE tb_vr
    ADD CONSTRAINT tb_vr_tb_veiculo_fk FOREIGN KEY ( tb_veiculo_id_veiculo )
        REFERENCES tb_veiculo ( id_veiculo );
ALTER TABLE tb_vz
    ADD CONSTRAINT tb_vz_tb_veiculo_fk FOREIGN KEY ( tb_veiculo_id_veiculo )
        REFERENCES tb_veiculo ( id_veiculo );
ALTER TABLE tb_vz
    ADD CONSTRAINT tb_vz_tb_zona_fk FOREIGN KEY ( tb_zona_id_zona )
        REFERENCES tb_zona ( id_zona );
ALTER TABLE tb_zb
    ADD CONSTRAINT tb_zb_tb_box_fk FOREIGN KEY ( tb_box_id_box )
        REFERENCES tb_box ( id_box );
ALTER TABLE tb_zb
    ADD CONSTRAINT tb_zb_tb_zona_fk FOREIGN KEY ( tb_zona_id_zona )
        REFERENCES tb_zona ( id_zona );
ALTER TABLE tb_zp
    ADD CONSTRAINT tb_zp_tb_patio_fk FOREIGN KEY ( tb_patio_id_patio )
        REFERENCES tb_patio ( id_patio );
ALTER TABLE tb_zp
    ADD CONSTRAINT tb_zp_tb_zona_fk FOREIGN KEY ( tb_zona_id_zona )
        REFERENCES tb_zona ( id_zona );


-- Adiciona CHECK constraint para Sexo (apenas 'M' ou 'H')
ALTER TABLE TB_CLIENTE
ADD CONSTRAINT CK_CLIENTE_SEXO
CHECK (SEXO IN ('M', 'H')); -- Ajuste 'H' se for 'O' de Homem, mas 'M' e 'H' é comum

-- Adiciona UNIQUE constraint para CPF (garante que cada CPF seja único)
ALTER TABLE TB_CLIENTE
ADD CONSTRAINT UK_CLIENTE_CPF UNIQUE (CPF);

-- Adiciona CHECK constraint para Estado Civil (liste os valores válidos)
-- SUBSTITUA 'Valor1', 'Valor2', etc., pela sua lista real de estados civis permitidos.
ALTER TABLE TB_CLIENTE
ADD CONSTRAINT CK_CLIENTE_ESTADO_CIVIL
CHECK (ESTADO_CIVIL IN ('Solteiro', 'Casado', 'Divorciado', 'Viúvo', 'Separado', 'União Estável')); -- Exemplo de lista

-- Adiciona CHECK constraint básica para DDD (ex: 11 a 99)
ALTER TABLE TB_CONTATO
ADD CONSTRAINT CK_CONTATO_DDD_RANGE
CHECK (DDD >= 11 AND DDD <= 99);

-- Garante que o Chassi seja único
ALTER TABLE TB_VEICULO
ADD CONSTRAINT UK_VEICULO_CHASSI UNIQUE (CHASSI);

-- Garante que o Renavam seja único
ALTER TABLE TB_VEICULO
ADD CONSTRAINT UK_VEICULO_RENAVAM UNIQUE (RENAVAM);

-- Garante que a Placa seja única (para veículos ativos no sistema)
ALTER TABLE TB_VEICULO
ADD CONSTRAINT UK_VEICULO_PLACA UNIQUE (PLACA);

-- 1. Adiciona o valor padrão SYSDATE para DATA_CADASTRO
-- Isso significa que se você não fornecer um valor para DATA_CADASTRO no INSERT,
-- o Oracle usará a data e hora atuais do sistema.
ALTER TABLE TB_CLIENTE
MODIFY DATA_CADASTRO DATE DEFAULT SYSDATE;

-- 2. Adiciona CHECK constraint para DATA_NASCIMENTO (não inferior a 1900-01-01)
ALTER TABLE TB_CLIENTE
ADD CONSTRAINT CK_CLIENTE_DATA_NASC_MIN
CHECK (DATA_NASCIMENTO >= TO_DATE('1900-01-01', 'YYYY-MM-DD'));










-- Relatório do Resumo do Oracle SQL Developer Data Modeler:
--
-- CREATE TABLE                            17
-- CREATE INDEX                             0
-- ALTER TABLE                             37
-- CREATE VIEW                              0
-- ALTER VIEW                               0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           0 -- (Triggers de auditoria removidos)
-- ALTER TRIGGER                            0
-- CREATE COLLECTION TYPE                   0
-- CREATE STRUCTURED TYPE                   0
-- CREATE STRUCTURED TYPE BODY              0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- CREATE MATERIALIZED VIEW LOG             0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
--
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
--
-- REDACTION POLICY                         0
--
-- ORDS DROP SCHEMA                         0
-- ORDS ENABLE SCHEMA                       0
-- ORDS ENABLE OBJECT                       0
--
-- ERRORS                                   0
-- WARNINGS                                 0